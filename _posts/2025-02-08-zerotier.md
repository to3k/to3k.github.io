---
title: "ZeroTier - domowy VPN bez publicznego adresu IP"
date: 2025-02-08
categories: 
  - "poradniki"
  - "self-hosting"
  - "smarthome"
tags: 
  - "android"
  - "dhcp"
  - "duckdns"
  - "dynamicdns"
  - "homeassistant"
  - "ios"
  - "iot"
  - "nabucasa"
  - "noip"
  - "openvpn"
  - "selfhosted"
  - "vpn"
  - "wireguard"
  - "zerotier"
image: "/images/zerotier.png"
---

[叼-> Go to english version of this post / Przejd藕 do angielskiej wersji tego wpisu](https://blog.tomaszdunia.pl/zerotier-eng/)

W poprzednich wpisach z cyklu smart home opisaem [jak zrobi w swoim domu "inteligentne" owietlenie w oparciu o produkty firmy _Shelly_](https://blog.tomaszdunia.pl/shelly-smart-oswietlenie/) oraz [jak postawi sw贸j wasny serwer do zarzdzania domowymi urzdzeniami IoT z wykorzystaniem systemu _Home Assistant_](https://blog.tomaszdunia.pl/home-assistant/). W ten spos贸b stworzylimy sobie mo偶liwo w peni zdalnego zarzdzania wiatem w swoim domu. Ale czy na pewno jest to "w peni zdalne" zarzdzanie? Ot贸偶 nie do koca, gdy偶 **serwer operuje jedynie w sieci lokalnej**, wic opuszczajc dom i tracc zasig _Wi-Fi_ na swoim telefonie cakowicie tracimy mo偶liwo sterowania czymkolwiek. **Konieczne jest udostpnienie sobie mo偶liwoci dostania si do serwera z zewntrz**. Istnieje co takiego jak _Home Assistant Cloud_ znane r贸wnie偶 jako _[Nabu Casa](https://www.nabucasa.com/)_, ale jest to usuga subskrypcyjna, a wic (wedug mnie niepotrzebnie) obci偶y tylko nasz portfel. **Idealn alternatyw byoby uruchomi na swoim routerze, bdcym bram wejciow do sieci domowej, tunelu _VPN_** (_Wireguard_, _OpenVPN_, ...), przez kt贸ry moglibymy **bezpiecznie wej z zewntrz urzdzeniem mobilnym do naszej sieci domowej**. Jednak偶e do uruchomienia takiej usugi **konieczne jest posiadanie publicznego adresu IP**. Chodzi o adres, kt贸ry bezporednio kieruje ruch sieciowy do naszego routera wejciowego. Nie nale偶y myli tego ze staym adresem IP, kt贸ry za dodatkow miesiczn opat (przewa偶nie ok. 10 z) mo偶na uzyska u wielu dostawc贸w usug internetowych. Adres publiczny mo偶e by zmienny, bo atwo mo偶na sobie z tym poradzi wykorzystujc dowolne (jest wiele darmowych) rozwizanie _Dynamic DNS_ pokroju [_NoIP.com_](https://www.noip.com/) lub [_DuckDNS.org_](https://www.duckdns.org/). Zatem **nie wa偶ne czy adres jest zmienny czy stay, wa偶ne aby by publiczny**. Pisz o tym dlatego, 偶e **uzyskanie publicznego adresu IP jest bardzo trudne lub wrcz niemo偶liwe, gdy jestemy zmuszeni do korzystania z internetu radiowego**. Dostawcy jak _T-Mobile_, _Plus_, _Play_, _Orange_ i inni maj do skomplikowane infrastruktury, kt贸re wygldaj jak wielkie drzewo, kt贸rego konary rozgaziaj si na mniejsze gazki (podsieci). To sprawia, 偶e **nie mo偶emy po prostu otworzy jakiego portu na routerze i wykorzystujc nasz adres IP**, kt贸ry poznamy np. na stronie [_WhatIsMyIP.com_](https://www.whatismyip.com/), dosta si do usugi, kt贸r wystawilimy na tym porcie z sieci lokalnej. Poka偶 to na wasnym przykadzie. Moim dostawc internetu radiowego jest _T-Mobile_. Sprawd藕my zatem jaki jest m贸j adres IP patrzc z zewntrz.

![](/images/tmobileipzew.png)

Teraz zobaczmy jakie informacje mog wyczyta na swoim routerze.

![](/images/tmobileipwew.png)

Adres _188.146.174.60_ nijak ma si do _10.76.187.110_, prawda? To za spraw tego, 偶e ten drugi jest moim adresem wewntrz sieci, a mo偶e nawet jednej z podsieci, _T-Mobile_. Zatem, aby ruch z zewntrz trafi na moje urzdzenie musi zosta najpierw skierowany pod adres _188.146.174.60_, nastpnie przechodzi przez nie znan mi ilo router贸w/switchy znajdujcych si wewntrz infrastruktury _T-Mobile_ i dopiero na samym kocu trafia pod adres _10.76.187.110_, kt贸ry jest tak naprawd moim indywidualnym identyfikatorem, kt贸ry znamy tylko _T-Mobile_ i ja, a kt贸ry jest obsugiwany przez jeden z tych wewntrznych router贸w bdcy, kt贸rym w kolei serwerem _DHCP_.

Brak publicznego adresu IP to problem, kt贸ry najczciej dotyczy wacicieli nowo wybudowanych dom贸w, kt贸re **postawiono na dziace nieuzbrojonej w wiatow贸d**. W najlepszym wypadku sie wiatowodowa znajduje si na kt贸rej z dziaek ssiadujcych, a w najgorszym nie ma jej w promieniu nawet kilku kilometr贸w. Tak czy siak, aby podczy si do sieci trzeba zawsze odczeka swoje i sporo si za tym nachodzi, dlatego wiele os贸b takich jak ja po prostu decyduje si na internet radiowy, kt贸ry bdzie wykorzystywany jako rozwizanie tymczasowe do momentu podczenia wiatowodu.

**Nie ma jednak problem贸w nie do rozwizania** i po tym lekko przydugim wstpie p**rzedstawi jak ogarn temat dostania si z zewntrz do swojej sieci domowej, gdy nie posiadamy publicznego adresu IP** i tym samym nie mo偶emy skonfigurowa sobie po prostu zwykego _VPN'a_. Wykorzystam do tego **darmow usug [_ZeroTier_](https://www.zerotier.com/)**.

## Zakadamy konto

Wchodzimy na stron [zerotier.com](https://www.zerotier.com/) i odnajdujemy w prawym g贸rnym rogu przycisk _Sign Up_. Zostaniemy przeniesieni do strony logowania, ale pomijamy sekcj _Log In_, bo my dopiero chcemy zao偶y konto. Poni偶ej znajdujemy przycisk _Sign Up_. W formularzu podajemy sw贸j adres e-mail, wpisujemy dwa razy haso i potwierdzamy przyciskiem _Sign Up_. Wchodzimy na swoj skrzynk mailow, na kt贸rej powinna ju偶 czeka wiadomo z linkiem potwierdzajcym, z kt贸rego oczywicie korzystamy. Teraz mo偶emy si ju偶 zalogowa do nowo utworzonego konta wykorzystujc wczeniej wpisane dane.

![](/images/2025.01.21-11_27_25.png)
    
![](/images/2025.01.21-11_27_52.png)
    
![](/images/2025.01.21-11_28_04.png)
    
![](/images/2025.01.21-11_28_47.png)
    

## Tworzymy sie wirtualn

Po zalogowaniu si pojawia nam si interfejs z tylko jednym przyciskiem _Create A Network_. Trzeba przyzna, 偶e szata graficzna _ZeroTier_ nie jest ekstrawagancka. Lubi taki prosty wygld bez 偶adnych rozpraszaczy. Idealny przykad stawiania funkcjonalnoci ponad wygld. Naciskamy ten偶e przycisk. Cyk i utworzony zosta szablon naszej nowej sieci wirtualnej. Wybieramy j z listy, aby wej do jej ustawie. Na g贸rze w polu tekstowym podpisanym _Network ID_ znajdziemy identyfikator sieci, kt贸ry p贸藕niej nam si przyda, wic zapisujemy go gdzie w notatniku. W moim przypadku jest to _8bd5124fd63b4288_. Wyprzedz pytanie - ta sie powstaa tylko na potrzeby tego wpisu i po zrobieniu materiau zostaa zutylizowana, wic mo偶na sobie darowa pr贸by ataku . Przewijamy dalej, aby w polu _Name_ nada wasn nazw dla sieci. Sprawd藕 te偶 koniecznie czy w sekcji _Access Control_ masz zaznaczone _Private_. Takie ustawienie wymusi konieczno autoryzacji ka偶dego urzdzenia, kt贸re bdzie chciao podczy si do tej sieci wirtualnej. Wczenie opcji _Public_ sprawioby, 偶e do przyczenia si potrzebna byaby tylko znajomo _Network ID_. Taka sytuacja byaby szalenie niebezpieczna przy tym do czego planujemy u偶y _ZeroTier_, tj. do wpuszczenia zewntrznego ruchu do wntrza swojej sieci domowej. Ostatnie co trzeba ustawi to adresacja wewntrz sieci wirtualnej, kt贸r wanie konfigurujemy. Istotnym jest, aby nie bya ona taka sama jak pula adres贸w naszego domowego serwera _DHCP_. Przykadowo je偶eli na routerze g贸wnym w domu mam ustawione, 偶e pula adres贸w sieci lokalnej to _192.168.1.0 - 192.168.1.254_ to nie mog w wirtualnej sieci _ZeroTier_ ustawi _192.168.1.\*_, bo bd mia konflikt. W takim przypadku mo偶na wybra jak pul z _10_ na pocztku, np. _10.147.17.\*_, wtedy jest pewno, 偶e nie bdzie problemu.

![](/images/2025.01.21-11_29_03.png)
    
![](/images/2025.01.21-11_29_27.png)
    
![](/images/2025.01.21-11_29_52.png)
    
![](/images/2025.01.21-11_30_23.png)
    
![](/images/2025.01.21-11_31_53.png)
    

## Konfiguracja po stronie Home Assistant

Na ten moment zrobilimy ju偶 wszystko po stronie interfejsu _ZeroTier_, wic pora przej do systemu _Home Assistant_. Wchodzimy do _Ustawienia -> Dodatki_. Nastpnie naciskamy przycisk _Sklep z dodatkami_. W wyszukiwarce wpisujemy "zerotier", po czym w wynikach wyszukiwania powinnimy otrzyma tylko jeden rezultat - "ZeroTier One". Instalujemy dodatek korzystajc z przycisku _Zainstaluj_. Po zakoczeniu instalacji przechodzimy do zakadki _Konfiguracja_. W sekcji _Opcje_ naciskamy trzy kropki w prawym g贸rnym rogu i wybieramy opcj _Edytuj w trybie YAML_. Nie trzeba tego tak robi, ale ja po prostu tak wol. Pojawi nam si edytor kodu, w kt贸rym wpisujemy nastpujc tre:

```yaml
networks:
  - 8bd5124fd63b4288
api_auth_token: ""
```

To jest wanie ten moment, w kt贸rym przyda nam si zapisany w notatniku identyfikator sieci wirtualnej _ZeroTier_. Po wprowadzeniu prawidowej wartoci zapisujemy zmiany przyciskiem _Zapisz_. Wracamy do zakadki _Informacje_ i naciskamy przycisk _Uruchom_. Dodatek powinien si uruchomi prawidowo, ale dla pewnoci mo偶na wej do zakadki _Logi_ i sprawdzi czy nie ma tam jaki informacji o bdach. Nie przejmuj si, 偶e prawdopodobnie niewiele zrozumiesz z zapis贸w w dzienniku, kt贸ry zobaczysz. Istotne, aby nie byo tam nic na czerwono lub frazy "error".

![](/images/2025.01.21-11_56_05.png)
    
![](/images/2025.01.21-11_56_50.png)
    
![](/images/2025.01.21-11_57_12.png)
    
![](/images/2025.01.21-11_57_27.png)
    
![](/images/2025.01.21-11_58_51.png)
    
![](/images/2025.01.21-12_00_07.png)
    
![](/images/2025.01.21-12_01_44.png)
    
![](/images/2025.01.21-12_02_28.png)
    
![](/images/2025.01.21-12_02_57.png)
    
![](/images/2025.01.21-12_03_48.png)
    

## Autoryzacja serwera Home Assistant

Wracamy do panelu sterowania _ZeroTier_ i wchodzimy do ustawie naszej sieci. Na licie w sekcji _Members_ powinien pojawi nam si pierwszy wpis. Widzimy, 偶e w kolumnie _Auth_ mamy czerwony znaczek oznaczajcy, 偶e dane urzdzenie nie zostao jeszcze wpuszczone do sieci. W celu przeprowadzenia autoryzacji naciskamy ikonk w kolumnie _Edit_. Otworzy si okienko, w kt贸rym zaznaczamy ptaszek przy _Authorized_ i nadajemy nazw dla tego urzdzenia w polu _Name_. Teraz wystarczy tylko nacisn przycisk _Save_. W prawym g贸rnym rogu pojawi si podwietlony na zielono napis _Authorized_ i urzdzenie otrzyma pozwolenie na przyczenie si do sieci wirtualnej.

![](/images/2025.01.21-12_04_37.png)
    
![](/images/2025.01.21-12_07_10.png)
    
![](/images/2025.01.21-12_07_21.png)
    

## Podczenie telefonu

Mam _iPhone_, wic zrzuty ekranu bd pokazywa jak to zrobi na _iOS_, ale dla _Android'a_ proces powinien wyglda analogicznie. Na telefonie wchodzimy do sklepu z aplikacjami i wyszukujemy appk _ZeroTier One_. Instalujemy i uruchamiamy j. Na wstpie prosi nas o akceptacj regulaminu, wic czytamy go uwa偶nie () i je偶eli nie mamy uwag to naciskamy _Accept_. Kolejnym krokiem jest dodanie nowej sieci co realizuje si poprzez nacinicie ikony plusika znajdujcej si w prawym g贸rnym rogu. W pole _Network ID_ wpisujemy wczeniej zapisany identyfikator sieci i naciskamy przycisk _Add Network_. System poprosi nas o zezwolenie na dodanie nowej konfiguracji _VPN_, naciskamy _Allow_. Nowa sie zostaa dodana. Trzeba j teraz wczy korzystajc z suwaka po prawej stronie.

![](/images/IMG_6917-472x1024.png)
    
![](/images/IMG_6918-472x1024.png)
    
![](/images/IMG_6919-472x1024.png)
    
![](/images/IMG_6920-472x1024.png)
    
![](/images/IMG_6921-472x1024.png)
    
![](/images/IMG_6922-472x1024.png)
    
![](/images/IMG_6923-472x1024.png)
    
![](/images/IMG_6924-472x1024.png)
    
![](/images/IMG_6925-472x1024.png)
    

Po stronie telefonu nie musimy na ten moment robi nic wicej. Przysza pora na powr贸t do panelu sterowania _ZeroTier_ i przeprowadzi autoryzacj telefonu. Robi si to tak samo jak opisaem wczeniej, wic nie bd tego powtarza. Finaem jest posiadanie na licie dw贸ch urzdze, kt贸re od tego momentu s ze sob poczone poprzez wirtualn sie _ZeroTier_.

![](/images/2025.01.21-12_12_01.png)
    
![](/images/2025.01.21-12_12_26.png)
    
![](/images/2025.01.21-12_12_35.png)
    
![](/images/2025.01.21-12_12_54.png)
    

## Sprawd藕my czy to dziaa

Wszystko poszo gadko, ale czy to w og贸le dziaa? Rozczamy si z sieci Wi-Fi, otwieramy przegldark i w pasek adresu wpisujemy _10.147.17.196:8123_. Dla ka偶dego ten adres bdzie prawdopodobnie inny. Og贸lnie jest to zlepek adresu serwera w sieci wirtualnej, kt贸ry mo偶na znale藕 w kolumnie _Managed IPs_, dwukropka i portu _8123_. Je偶eli wszystko zrobilimy prawidowo to po zaadowaniu strony powinnimy zobaczy panel logowania do _Home Assistant_, a po wpisaniu prawidowych loginu i hasa uzyska dostp do naszego panelu zarzdzania domowymi urzdzeniami _IoT_.

![](/images/IMG_6926-472x1024.png)
    
![](/images/IMG_6927-472x1024.png)
    
![](/images/IMG_6928-472x1024.png)
    

## Aplikacja Home Assistant

Do peni szczcia i wygody brakuje nam jeszcze tylko aplikacji _Home Assistant_ na smartfonie, dlatego pdzimy do sklepu z appkami i w wyszukiwark wpisujemy _Home Assistant_. Pobieramy i uruchamiamy. Na dzie dobry ekran powitalny, na kt贸rym naciskamy przycisk _Continue_. Aplikacja zapyta czy pozwalamy na skanowanie sieci lokalnej w poszukiwaniu urzdze. Nie musisz tego robi, bo mo偶na to skonfigurowa bez tego, gdy偶 w nastpnym kroku dostaniemy mo偶liwo rcznego wpisania adresu serwera - _Enter Address Manually_. Wpisujemy ten sam adres, kt贸ry wczeniej wpisywalimy w pasek adresu przegldarki. W moim przypadku byo to _10.147.17.196:8123_. Naciskamy przycisk _Connect_. Wyskoczy jeszcze monit, 偶e podalimy goy adres bez wskazanego protokou, wic wybieramy, 偶e chcemy skorzysta z protokou _HTTP (http://)_. Jeszcze tylko ekran logowania, zapytanie o to czy chcemy wczy powiadomienia i gotowe. Mamy dostp do prawdziwie zdalnego sterowania naszym "inteligentnym" domem z poziomu smartfona!

![](/images/IMG_6929-472x1024.png)
    
![](/images/IMG_6930-472x1024.png)
    
![](/images/IMG_6931-472x1024.png)
    
![](/images/IMG_6932-472x1024.png)
    
![](/images/IMG_6933-472x1024.png)
    
![](/images/IMG_6934-472x1024.png)
    
![](/images/IMG_6935-472x1024.png)
    
![](/images/IMG_6936-472x1024.png)
    
![](/images/IMG_6937-472x1024.png)
    
![](/images/IMG_6938-472x1024.png)
    
![](/images/IMG_6939-472x1024.png)
    

## Podsumowanie

Mimo, 偶e opisany przeze mnie powy偶ej spos贸b jest bardzo atwy, wygodny i darmowy to koniecznie trzeba pamita, 偶e nie jest to rozwizanie idealne. Mam do niego kilka zarzut贸w, a g贸wnym jest to, 偶e bazujemy na infrastrukturze dostawcy trzeciego, a takim nigdy nie mo偶na ufa. _ZeroTier_ ma og贸lnie dobr renom, ale mimo to jest to tak naprawd wpuszczanie obcego do swojej sieci domowej. W przypadkach podbramkowych, gdy nie ma wyjcia, lub jako rozwizanie dora藕ne/chwilowe jest do zaakceptowania, ale na du偶sz met zawsze bd poleca spr贸bowa pozyska od dostawcy internetu prawdziwie publiczny adres IP i stworzy dla siebie zwyky tunel _VPN_ czy to przy pomocy _Wireguard_ czy chocia偶by _OpenVPN_. Jest to rozwizanie lepsze, bo sami stawiamy serwer _VPN_ na routerze lub serwerze dziaajcym w sieci lokalnej i spinamy go z klientami, bez porednik贸w. Takie troch "umiesz liczy, licz na siebie".
