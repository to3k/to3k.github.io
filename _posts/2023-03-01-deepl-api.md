---
title: "Translator DeepL - tumaczenie u偶ywajc API"
date: 2023-03-01
categories: 
  - "poradniki"
tags: 
  - "api"
  - "curl"
  - "deepl"
  - "json"
  - "mastodon"
  - "opensource"
  - "php"
  - "tlumacz"
  - "tlumaczenie"
  - "translator"
coverImage: "deeplapi.png"
---

[ Go to english version of this post / Przejd藕 do angielskiej wersji tego wpisu](https://blog.tomaszdunia.pl/deepl-api-eng/)

_DeepL_ to usuga przekadu maszynowego, co w normalnych sowach mo偶na okreli po prostu jako **tumacz**, dziaajca w oparciu o sieci neuronowe. Co ciekawe dyrektorem zarzdzajcym sp贸ki stojcej za tym tumaczem jest **Polak** - Jarosaw Kutyowski. Wydaje mi si, 偶e ju偶 od blisko 5 lat u偶ywam _DeepL_, a nie powszechnie znanego _Google Translate_, bo po prostu daje mi lepsze wyniki, a i przy okazji trzymam swoje dane nieco dalej od _Google_. Do normalnego u偶ytku _DeepL_ jest **darmowy** i dostpny z poziomu strony internetowej. Mo偶na tak偶e zao偶y konto i uzyska dostp do dw贸ch plan贸w dostpowych poprzez _API_ - _Free_ i _Pro_. Nas oczywicie interesuje ten **darmowy, kt贸ry obarczony jest ograniczeniem 500 000 znak贸w na miesic**. Do podstawowych zastosowa jednego u偶ytkownika taki limit powinien by wystarczajcy.

## Jak pozyska sw贸j klucz API

Skr贸c to do niezbdnego minimum, 偶eby zbytnio nie rozwodzi si nad tak prostym procesem. Rozpoczynamy oczywicie od **zao偶enia konta** - [bezporedni link do rejestracji](https://www.deepl.com/pl/pro-checkout/account?productId=1200&yearly=false&trial=false). W panelu swojego konta przechodzimy do zakadki _Konto_, na samym dole w sekcji _Klucz identyfikacyjny dla API DeepL_ jest podany _token API_, kt贸ry bdzie nam potrzebny w dalszej czci tego wpisu. Jak ju偶 jestemy w tym miejscu to dla bardziej dociekliwych polecam tak偶e zapozna si z [dokumentacj dotyczc _API_](https://www.deepl.com/docs-api).

## Komunikacja z API DeepL

Caa komunikacja z _API DeepL_ wyglda bardzo podobnie do tej opisanej przeze mnie we wpisie _[MEWS Bot = Mastodon nEWS](https://blog.tomaszdunia.pl/mews/)_, w kt贸rym przy u偶yciu _cURL_ komunikowalimy si z _API_ _Mastodona_. R贸偶nica w tym przypadku bdzie taka, 偶e do _Mastodona_ jedynie wysyalimy dane, natomiast **do _DeepL_ dane wylemy (bdzie to tekst do przetumaczenia), ale bdziemy tak偶e oczekiwali odpowiedzi (tekstu przetumaczonego)**. Cay kod standardowo opisaem krok po kroku poprzez umieszczenie w nim komentarzy. Tre skryptu jest dostpna pod koniec wpisu.

Zanim przejdziemy do skryptu chciabym jednak om贸wi szerzej pewne jego fragmenty, aby nakreli perspektyw. Jednz najbardziej kluczowych rzeczy w komunikacji z _API_ poprzez _cURL_ s odpowiednio skonstruowane _**nag贸wki**_ (_headers_), kt贸re **s swego rodzaju zapowiedzi 偶dania**, kt贸re wylemy do serwera. W przypadku _API_ _DeepL_ jedyna informacja, kt贸ra musi by zawarta w nag贸wku to prawidowe dane do autoryzacji, tj. przedstawienie swojego klucza do _API_, na podstawie kt贸rego uzyskujemy prawo do komunikacji. Nag贸wek ten powinien mie nastpujc form:

> Authorization: DeepL-Auth-Key \[TOKEN/KLUCZ API\]

Drugim istotnym elementem zapytania _cURL_ jest **_adres URL_**, do kt贸rego nale偶y kierowa zapytania. W przypadku _DeepL_ jest to:

> https://api-free.deepl.com/v2/translate

Trzeci element, bez kt贸rego zapytanie nie miaoby sensu, to **dane waciwe**, a wic samo 偶danie. Dane te najlepiej wysa w postaci _tablicy_ (_array_). Bdziemy wysya w niej trzy rzeczy:

- cig (tekst) do przetumaczenia,

- deklaracj na jaki jzyk 偶yczymy sobie go przetumaczy,

- deklaracj w jakim jzyku napisany jest 贸w tekst, kt贸ry podalimy w punkcie pierwszym.

Ten ostatni punkt nie jest konieczny, gdy偶 _DeepL_ sam jest w stanie rozpozna w jakim jzyku zaserwowalimy mu tekst do przetumaczenia. Niemniej jednak z dowiadcze z u偶ywania wersji webowej _DeepL_ wiem, 偶e algorytm rozpoznawania jzyka nie jest nieomylny, a wic zdecydowanie rekomenduj dla pewnoci jasno okreli ten parametr.

OK, wysyamy odpowiednio skonstruowane zapytanie _cURL_ do _API_ _DeepL_ i co dalej? Otrzymujemy **informacje zwrotne** w postaci cigu w formacie [_JSON_](https://pl.wikipedia.org/wiki/JSON) (_JavaScript Object Notation_). Dekodujemy go przy u偶yciu funkcji _json\_decode()_. Na marginesie, jako drugi argument przy wywoaniu tej funkcji podajemy warto _true_, co informuje funkcj, aby nie tylko przekonwertowa nam cig _JSON_ na obiekt _PHP_, ale te偶 aby ten obiekt przekonwertowa na tablic. W ten oto spos贸b otrzymujemy nastpujcy wynik:

```php
Array
(
    [translations] => Array
        (
            [0] => Array
                (
                    [detected_source_language] => PL
                    [text] => Sample text in Polish that we want to translate into English
                )
        )
)
```

Jak wida otrzymalimy zagnie偶d偶on tablic, a wynik, kt贸rego oczekujemy jest zapisany pod indeksem _\[translations\]\[0\]\[text\]_. I tym oto sposobem uzyskalimy dostp do przetumaczonego tekstu, kt贸rego oczekiwalimy.

## Kod skryptu PHP

Tak jak pisaem wczeniej, poni偶ej znajduje si **cay kod skryptu**, o kt贸rym mowa w niniejszym wpisie. Jest on standardowo om贸wiony poprzez **komentarze w treci**.

```php
<?php
// Klucz skopiowany z profilu DeepL
$token = "[Tu wpisz sw贸j klucz API DeepL]";
// Przykadowy tekst, kt贸ry bdziemy tumaczy
$tekstPL = "Przykadowy tekst w jzyku polskim, kt贸ry chcemy przetumaczy na jzyk angielski";

//Nag贸wki
$headers = [
    "Authorization: DeepL-Auth-Key ".$token
];
//Dane waciwe
$data = array(
    "text" => $tekstPL, // Tekst do tumaczenia
    "target_lang" => "EN", // Jzyk docelowy
    "source_lang" => "PL" // Jzyk 藕r贸dowy
);

// Inicjalizuje zapytanie cURL
$translate = curl_init();
// Okrela URL do kt贸rego ma zosta skierowane zapytanie
curl_setopt($translate, CURLOPT_URL, "https://api-free.deepl.com/v2/translate");
// Deklaruje, 偶e ma to by zapytanie typu POST
curl_setopt($translate, CURLOPT_POST, 1);
// Nakazuje cURL zwr贸ci wynik zapytania
curl_setopt($translate, CURLOPT_RETURNTRANSFER, true);
// Ustawia nag贸wki
curl_setopt($translate, CURLOPT_HTTPHEADER, $headers);
// Definiuje dane do przekazania
curl_setopt($translate, CURLOPT_POSTFIELDS, $data);
// Wysya zapytanie i zapisuje zdekodowany wynik do zmiennej
$return = json_decode(curl_exec($translate), true);
// Zamyka poczenie
curl_close ($translate);

//Wyciga przetumaczony tekst z odpowiedzi API
$tekstENG = $return['translations'][0]['text'];

// Wywietlenie wynik贸w
echo "<b>Tak wyglda zdekodowana odpowied藕 z API DeepL:</b><br>";
echo "<pre>";
print_r($return);
echo "</pre>";
echo "<br><br><br>";

echo "<b>Tekst po polsku:</b><br>";
echo $tekstPL;
echo "<br><br>";
echo "<b>Tekst po angielsku (przetumaczony przez DeepL):</b><br>";
echo $tekstENG;
?>
```

Wynik powy偶szego skryptu jest nastpujcy:

![](images/AE24041A-B186-4F36-8C6C-75F53754948D.jpeg)

## BiLangPost

Ten wpis zosta napisany przy okazji wypuszczenia przeze mnie mojego kolejnego, maego projekciku jakim jest [_BiLangPost_](https://bilangpost.tomaszdunia.pl). Jest to **narzdzie, kt贸re uatwia pisanie dwujzycznych post贸w** w mediach spoecznociowych, a zostao napisane z myl konkretnie o _Mastodonie_. Kolejny projekt narzdzia, kt贸re pierwotnie robiem dla siebie, ale w pewnym momencie doszedem do wniosku, 偶e wystarczy zmieni/doda jedynie kilka linijek i mo偶na udostpni go szerszemu gronu. Przy okazji tego wpisu nie bd si wicej rozpisywa, bo pewnie zrobi cakowicie oddzielny wpis jedynie na temat _BiLangPost_.
